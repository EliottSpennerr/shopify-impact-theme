{% doc %}
  @prompt
    Create a clean, modern product gallery section for the homepage that automatically displays our top-selling products.
    
    Layout: 3–4 products per row, responsive grid (1 on mobile, 2 on tablet, 4 on desktop)
    
    Each product card should include: product image, title, price, and a “Shop now” or “Add to cart” button
    
    Include a heading above the grid: “Our Top Products”
    
    Keep spacing elegant with soft shadows and rounded corners
    
    Use the store’s theme colors and typography automatically
    
    Add hover effect that slightly zooms the image
    
    Include dynamic product data (no hardcoded products) — pull from Shopify’s “Best selling” collection or tag “top”
    
    Add optional subtitle text under the heading: “Customer favorites, made in Finland.”
    
    Section should be easy to reuse and customizable (e.g. change title, number of products, and tag), Ska vara horisontal scrolling så om jag väljer max 1 produkter som visas på mobile eller dekstop ska jag kunna scrolla höger med touch. Sen vill jag även ha pilar i högra hörnet. Vill kunna aligna titel till vänstra hörnet också och justera storlek, Lägg till lite padding runt produktfälten så det är lite whitepace runt. samt lägg lite mer whitespace ovan titeln., Lägg till lite padding runt produktfälten så det är lite whitepace runt. samt lägg lite mer whitespace ovan titeln., Lägg till så hela bilden visas. i produktfältet. Samt mobilanpassa pilarna för att trycka fram och tillbaka., På titeln gär så jag kan ändra storlek och text rad mellarnrum., På titeln gär så jag kan ändra storlek och text rad mellarnrum.
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-product-gallery-{{ ai_gen_id }} {
    padding: {{ block.settings.section_padding_top }}px 0 {{ block.settings.section_padding_bottom }}px;
    background-color: {{ block.settings.background_color }};
    overflow: hidden;
  }

  .ai-product-gallery__container-{{ ai_gen_id }} {
    max-width: 1600px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .ai-product-gallery__header-{{ ai_gen_id }} {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    margin-bottom: {{ block.settings.header_spacing }}px;
    gap: 20px;
  }

  .ai-product-gallery__text-{{ ai_gen_id }} {
    flex: 1;
    text-align: {{ block.settings.heading_alignment }};
  }

  .ai-product-gallery__heading-{{ ai_gen_id }} {
    font-size: {{ block.settings.heading_size_mobile }}px;
    color: {{ block.settings.text_color }};
    margin: 0 0 8px 0;
    font-weight: 700;
    line-height: {{ block.settings.heading_line_height }};
    letter-spacing: {{ block.settings.heading_letter_spacing }}px;
  }

  @media screen and (min-width: 750px) {
    .ai-product-gallery__heading-{{ ai_gen_id }} {
      font-size: {{ block.settings.heading_size }}px;
    }
  }

  .ai-product-gallery__subtitle-{{ ai_gen_id }} {
    font-size: {{ block.settings.subtitle_size }}px;
    color: {{ block.settings.text_color }};
    opacity: 0.7;
    margin: 0;
  }

  .ai-product-gallery__nav-{{ ai_gen_id }} {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
  }

  .ai-product-gallery__arrow-{{ ai_gen_id }} {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: {{ block.settings.arrow_background }};
    color: {{ block.settings.arrow_color }};
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    flex-shrink: 0;
  }

  @media screen and (min-width: 750px) {
    .ai-product-gallery__arrow-{{ ai_gen_id }} {
      width: 48px;
      height: 48px;
    }
  }

  .ai-product-gallery__arrow-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.arrow_hover_background }};
    transform: scale(1.05);
  }

  .ai-product-gallery__arrow-{{ ai_gen_id }}:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .ai-product-gallery__arrow-{{ ai_gen_id }}:disabled:hover {
    transform: scale(1);
  }

  .ai-product-gallery__arrow-{{ ai_gen_id }} svg {
    width: 16px;
    height: 16px;
  }

  @media screen and (min-width: 750px) {
    .ai-product-gallery__arrow-{{ ai_gen_id }} svg {
      width: 20px;
      height: 20px;
    }
  }

  .ai-product-gallery__scroll-container-{{ ai_gen_id }} {
    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    margin: 0 -20px;
    padding: {{ block.settings.scroll_padding }}px 20px;
  }

  .ai-product-gallery__scroll-container-{{ ai_gen_id }}::-webkit-scrollbar {
    display: none;
  }

  .ai-product-gallery__grid-{{ ai_gen_id }} {
    display: flex;
    gap: 24px;
    width: max-content;
  }

  .ai-product-card-{{ ai_gen_id }} {
    background-color: {{ block.settings.card_background }};
    border-radius: {{ block.settings.card_border_radius }}px;
    overflow: hidden;
    box-shadow: 0 {{ block.settings.shadow_vertical_offset }}px {{ block.settings.shadow_blur }}px rgba(0, 0, 0, {{ block.settings.shadow_opacity | divided_by: 100.0 }});
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    display: flex;
    flex-direction: column;
    height: 100%;
    width: {{ block.settings.card_width_mobile }}px;
    flex-shrink: 0;
  }

  @media screen and (min-width: 750px) {
    .ai-product-card-{{ ai_gen_id }} {
      width: {{ block.settings.card_width }}px;
    }
  }

  .ai-product-card-{{ ai_gen_id }}:hover {
    transform: translateY(-4px);
    box-shadow: 0 {{ block.settings.shadow_vertical_offset | plus: 8 }}px {{ block.settings.shadow_blur | plus: 10 }}px rgba(0, 0, 0, {{ block.settings.shadow_opacity | divided_by: 100.0 | times: 1.5 }});
  }

  .ai-product-card__image-wrapper-{{ ai_gen_id }} {
    position: relative;
    overflow: hidden;
    width: 100%;
    background-color: #f4f4f4;
  }

  .ai-product-card__image-{{ ai_gen_id }} {
    width: 100%;
    height: auto;
    display: block;
    transition: transform 0.5s ease;
  }

  .ai-product-card-{{ ai_gen_id }}:hover .ai-product-card__image-{{ ai_gen_id }} {
    transform: scale(1.08);
  }

  .ai-product-card__image-placeholder-{{ ai_gen_id }} {
    width: 100%;
    aspect-ratio: 1 / 1;
    background-color: #f4f4f4;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ai-product-card__image-placeholder-{{ ai_gen_id }} svg {
    width: 100%;
    height: 100%;
  }

  .ai-product-card__badge-{{ ai_gen_id }} {
    position: absolute;
    top: 12px;
    right: 12px;
    background-color: {{ block.settings.badge_background }};
    color: {{ block.settings.badge_text_color }};
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
  }

  .ai-product-card__content-{{ ai_gen_id }} {
    padding: {{ block.settings.card_padding }}px;
    display: flex;
    flex-direction: column;
    flex-grow: 1;
  }

  .ai-product-card__title-{{ ai_gen_id }} {
    font-size: {{ block.settings.product_title_size }}px;
    font-weight: 600;
    color: {{ block.settings.text_color }};
    margin: 0 0 8px 0;
    line-height: {{ block.settings.product_title_line_height }};
  }

  .ai-product-card__title-link-{{ ai_gen_id }} {
    color: inherit;
    text-decoration: none;
  }

  .ai-product-card__title-link-{{ ai_gen_id }}:hover {
    opacity: 0.8;
  }

  .ai-product-card__price-{{ ai_gen_id }} {
    font-size: 20px;
    font-weight:700;
    color: {{ block.settings.text_color }};
    margin: 0 0 16px 0;
  }

  .ai-product-card__price--compare-{{ ai_gen_id }} {
    text-decoration: line-through;
    opacity: 0.5;
    font-size: 16px;
    margin-right: 8px;
  }

  .ai-product-card__button-{{ ai_gen_id }} {
    margin-top: auto;
    width: 100%;
    padding: 14px 24px;
    background-color: {{ block.settings.button_background }};
    color: {{ block.settings.button_text_color }};
    border: none;
    border-radius: {{ block.settings.button_border_radius }}px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    text-align: center;
  }

  .ai-product-card__button-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.button_hover_background }};
    transform: translateY(-2px);
  }

  .ai-product-gallery__empty-{{ ai_gen_id }} {
    text-align: center;
    padding: 60px 20px;
    color: {{ block.settings.text_color }};
    opacity: 0.6;
  }
{% endstyle %}

<product-gallery-{{ ai_gen_id }} class="ai-product-gallery-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-product-gallery__container-{{ ai_gen_id }}">
    <div class="ai-product-gallery__header-{{ ai_gen_id }}">
      <div class="ai-product-gallery__text-{{ ai_gen_id }}">
        {% if block.settings.heading != blank %}
          <h2 class="ai-product-gallery__heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
        {% endif %}
        {% if block.settings.subtitle != blank %}
          <p class="ai-product-gallery__subtitle-{{ ai_gen_id }}">{{ block.settings.subtitle }}</p>
        {% endif %}
      </div>

      <div class="ai-product-gallery__nav-{{ ai_gen_id }}">
        <button
          class="ai-product-gallery__arrow-{{ ai_gen_id }} ai-product-gallery__arrow--prev-{{ ai_gen_id }}"
          aria-label="Föregående produkter"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <button
          class="ai-product-gallery__arrow-{{ ai_gen_id }} ai-product-gallery__arrow--next-{{ ai_gen_id }}"
          aria-label="Nästa produkter"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
    </div>

    {% liquid
      assign products_to_show = blank
      
      if block.settings.collection != blank
        assign products_to_show = block.settings.collection.products
      elsif block.settings.product_tag != blank
        assign products_to_show = collections.all.products | where: 'tags', block.settings.product_tag
      else
        assign products_to_show = collections.all.products
      endif
    %}

    {% if products_to_show.size > 0 %}
      <div class="ai-product-gallery__scroll-container-{{ ai_gen_id }}">
        <div class="ai-product-gallery__grid-{{ ai_gen_id }}">
          {% for product in products_to_show limit: block.settings.products_count %}
            <div class="ai-product-card-{{ ai_gen_id }}">
              <div class="ai-product-card__image-wrapper-{{ ai_gen_id }}">
                {% if product.featured_image %}
                  <img
                    src="{{ product.featured_image | image_url: width: 800 }}"
                    alt="{{ product.featured_image.alt | escape }}"
                    loading="lazy"
                    width="{{ product.featured_image.width }}"
                    height="{{ product.featured_image.height }}"
                    class="ai-product-card__image-{{ ai_gen_id }}"
                  >
                {% else %}
                  <div class="ai-product-card__image-placeholder-{{ ai_gen_id }}">
                    {{ 'product-1' | placeholder_svg_tag }}
                  </div>
                {% endif %}

                {% if product.compare_at_price > product.price %}
                  <div class="ai-product-card__badge-{{ ai_gen_id }}">
                    {% if block.settings.discount_type == 'percentage' %}
                      -{{ product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price }}%
                    {% else %}
                      Spara {{ product.compare_at_price | minus: product.price | money }}
                    {% endif %}
                  </div>
                {% endif %}
              </div>

              <div class="ai-product-card__content-{{ ai_gen_id }}">
                <h3 class="ai-product-card__title-{{ ai_gen_id }}">
                  <a href="{{ product.url }}" class="ai-product-card__title-link-{{ ai_gen_id }}">
                    {{ product.title }}
                  </a>
                </h3>

                <div class="ai-product-card__price-{{ ai_gen_id }}">
                  {% if product.compare_at_price > product.price %}
                    <span class="ai-product-card__price--compare-{{ ai_gen_id }}">
                      {{ product.compare_at_price | money }}
                    </span>
                  {% endif %}
                  <span>{{ product.price | money }}</span>
                </div>

                <a href="{{ product.url }}" class="ai-product-card__button-{{ ai_gen_id }}">
                  {{ block.settings.button_text }}
                </a>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% else %}
      <div class="ai-product-gallery__empty-{{ ai_gen_id }}">
        <p>Inga produkter hittades. Välj en kollektion eller lägg till produkter med angiven tagg.</p>
      </div>
    {% endif %}
  </div>
</product-gallery-{{ ai_gen_id }}>

<script>
  (function() {
    class ProductGallery{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.scrollContainer = this.querySelector('.ai-product-gallery__scroll-container-{{ ai_gen_id }}');
        this.prevButton = this.querySelector('.ai-product-gallery__arrow--prev-{{ ai_gen_id }}');
        this.nextButton = this.querySelector('.ai-product-gallery__arrow--next-{{ ai_gen_id }}');
      }

      connectedCallback() {
        if (!this.scrollContainer) return;

        this.prevButton.addEventListener('click', () => this.scroll('prev'));
        this.nextButton.addEventListener('click', () => this.scroll('next'));
        
        this.scrollContainer.addEventListener('scroll', () => this.updateButtons());
        
        this.updateButtons();
      }

      scroll(direction) {
        const cardWidth = this.scrollContainer.querySelector('.ai-product-card-{{ ai_gen_id }}').offsetWidth;
        const gap = 24;
        const scrollAmount = cardWidth + gap;
        
        if (direction === 'prev') {
          this.scrollContainer.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
        } else {
          this.scrollContainer.scrollBy({ left: scrollAmount, behavior: 'smooth' });
        }
      }

      updateButtons() {
        const isAtStart = this.scrollContainer.scrollLeft <= 0;
        const isAtEnd = this.scrollContainer.scrollLeft + this.scrollContainer.clientWidth >= this.scrollContainer.scrollWidth - 1;
        
        this.prevButton.disabled = isAtStart;
        this.nextButton.disabled = isAtEnd;
      }
    }

    customElements.define('product-gallery-{{ ai_gen_id }}', ProductGallery{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Top products gallery",
  "settings": [
    {
      "type": "header",
      "content": "Innehåll"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "label": "Rubrik",
      "default": "Våra topprodukter"
    },
    {
      "type": "inline_richtext",
      "id": "subtitle",
      "label": "Underrubrik",
      "default": "Kundfavoriter, gjorda i Finland."
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Rubrikjustering",
      "options": [
        {
          "value": "left",
          "label": "Vänster"
        },
        {
          "value": "center",
          "label": "Centrerad"
        },
        {
          "value": "right",
          "label": "Höger"
        }
      ],
      "default": "left"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Kollektion",
      "info": "Lämna tom för att använda produkttagg istället"
    },
    {
      "type": "text",
      "id": "product_tag",
      "label": "Produkttagg",
      "default": "top",
      "info": "Används endast om ingen kollektion är vald"
    },
    {
      "type": "range",
      "id": "products_count",
      "min": 2,
      "max": 20,
      "step": 1,
      "label": "Antal produkter",
      "default": 12
    },
    {
      "type": "inline_richtext",
      "id": "button_text",
      "label": "Knapptext",
      "default": "Handla nu"
    },
    {
      "type": "select",
      "id": "discount_type",
      "label": "Rabattvisning",
      "options": [
        {
          "value": "percentage",
          "label": "Procent"
        },
        {
          "value": "amount",
          "label": "Sparat belopp"
        }
      ],
      "default": "percentage"
    },
    {
      "type": "header",
      "content": "Avstånd"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding ovan",
      "default": 80
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding nedan",
      "default": 60
    },
    {
      "type": "range",
      "id": "header_spacing",
      "min": 20,
      "max": 80,
      "step": 4,
      "unit": "px",
      "label": "Avstånd under rubrik",
      "default": 48
    },
    {
      "type": "range",
      "id": "scroll_padding",
      "min": 0,
      "max": 40,
      "step": 4,
      "unit": "px",
      "label": "Padding runt produkter",
      "default": 20
    },
    {
      "type": "range",
      "id": "card_padding",
      "min": 12,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Padding i produktkort",
      "default": 24
    },
    {
      "type": "header",
      "content": "Huvudrubrik"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 24,
      "max": 72,
      "step": 2,
      "unit": "px",
      "label": "Rubrikstorlek (desktop)",
      "default": 42
    },
    {
      "type": "range",
      "id": "heading_size_mobile",
      "min": 20,
      "max": 48,
      "step": 2,
      "unit": "px",
      "label": "Rubrikstorlek (mobil)",
      "default": 28
    },
    {
      "type": "range",
      "id": "heading_line_height",
      "min": 1,
      "max": 2,
      "step": 0.1,
      "label": "Radavstånd",
      "default": 1.2
    },
    {
      "type": "range",
      "id": "heading_letter_spacing",
      "min": -2,
      "max": 4,
      "step": 0.5,
      "unit": "px",
      "label": "Teckenavstånd",
      "default": 0
    },
    {
      "type": "range",
      "id": "subtitle_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Underrubrikstorlek",
      "default": 16
    },
    {
      "type": "header",
      "content": "Produkttitel"
    },
    {
      "type": "range",
      "id": "product_title_size",
      "min": 12,
      "max": 28,
      "step": 1,
      "unit": "px",
      "label": "Titelstorlek",
      "default": 18
    },
    {
      "type": "range",
      "id": "product_title_line_height",
      "min": 1,
      "max": 2,
      "step": 0.1,
      "label": "Radavstånd",
      "default": 1.3
    },
    {
      "type": "header",
      "content": "Kortstorlek"
    },
    {
      "type": "range",
      "id": "card_width",
      "min": 200,
      "max": 400,
      "step": 10,
      "unit": "px",
      "label": "Kortbredd (desktop)",
      "default": 300
    },
    {
      "type": "range",
      "id": "card_width_mobile",
      "min": 200,
      "max": 350,
      "step": 10,
      "unit": "px",
      "label": "Kortbredd (mobil)",
      "default": 280
    },
    {
      "type": "header",
      "content": "Färger"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Bakgrund",
      "default": "#f0f0f0"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#1a2533"
    },
    {
      "type": "header",
      "content": "Produktkort"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Kortbakgrund",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "min": 0,
      "max": 40,
      "step": 4,
      "unit": "px",
      "label": "Korthörn radie",
      "default": 24
    },
    {
      "type": "range",
      "id": "shadow_opacity",
      "min": 0,
      "max": 30,
      "step": 1,
      "unit": "%",
      "label": "Skuggopacitet",
      "default": 10
    },
    {
      "type": "range",
      "id": "shadow_vertical_offset",
      "min": 0,
      "max": 32,
      "step": 2,
      "unit": "px",
      "label": "Skugga vertikal offset",
      "default": 18
    },
    {
      "type": "range",
      "id": "shadow_blur",
      "min": 0,
      "max": 60,
      "step": 5,
      "unit": "px",
      "label": "Skuggoskärpa",
      "default": 50
    },
    {
      "type": "header",
      "content": "Märke"
    },
    {
      "type": "color",
      "id": "badge_background",
      "label": "Märkesbakgrund",
      "default": "#803cee"
    },
    {
      "type": "color",
      "id": "badge_text_color",
      "label": "Märkestext",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Knapp"
    },
    {
      "type": "color",
      "id": "button_background",
      "label": "Knappbakgrund",
      "default": "#0962fa"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Knapptext",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_hover_background",
      "label": "Knapp hover bakgrund",
      "default": "#1a2533"
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "min": 0,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Knapphörn radie",
      "default": 60
    },
    {
      "type": "header",
      "content": "Navigeringsknappar"
    },
    {
      "type": "color",
      "id": "arrow_background",
      "label": "Pilbakgrund",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "arrow_color",
      "label": "Pilfärg",
      "default": "#1a2533"
    },
    {
      "type": "color",
      "id": "arrow_hover_background",
      "label": "Pil hover bakgrund",
      "default": "#1a2533"
    }
  ],
  "presets": [
    {
      "name": "Top products gallery"
    }
  ]
}
{% endschema %}
