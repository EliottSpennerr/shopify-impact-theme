{% doc %}
  @prompt
    Create a clean, modern product gallery section for the homepage that automatically displays our top-selling products.
    
    Layout: 3–4 products per row, responsive grid (1 on mobile, 2 on tablet, 4 on desktop)
    
    Each product card should include: product image, title, price, and a “Shop now” or “Add to cart” button
    
    Include a heading above the grid: “Our Top Products”
    
    Keep spacing elegant with soft shadows and rounded corners
    
    Use the store’s theme colors and typography automatically
    
    Add hover effect that slightly zooms the image
    
    Include dynamic product data (no hardcoded products) — pull from Shopify’s “Best selling” collection or tag “top”
    
    Add optional subtitle text under the heading: “Customer favorites, made in Finland.”
    
    Section should be easy to reuse and customizable (e.g. change title, number of products, and tag)
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-product-gallery-{{ ai_gen_id }} {
    padding: 60px 20px;
    background-color: {{ block.settings.background_color }};
  }

  .ai-product-gallery__container-{{ ai_gen_id }} {
    max-width: 1600px;
    margin: 0 auto;
  }

  .ai-product-gallery__header-{{ ai_gen_id }} {
    text-align: center;
    margin-bottom: 48px;
  }

  .ai-product-gallery__heading-{{ ai_gen_id }} {
    font-size: {{ block.settings.heading_size }}px;
    color: {{ block.settings.text_color }};
    margin: 0 0 12px 0;
    font-weight: 700;
  }

  .ai-product-gallery__subtitle-{{ ai_gen_id }} {
    font-size: {{ block.settings.subtitle_size }}px;
    color: {{ block.settings.text_color }};
    opacity: 0.7;
    margin: 0;
  }

  .ai-product-gallery__grid-{{ ai_gen_id }} {
    display: grid;
    grid-template-columns: 1fr;
    gap: 24px;
  }

  @media screen and (min-width: 750px) {
    .ai-product-gallery__grid-{{ ai_gen_id }} {
      grid-template-columns: repeat(2, 1fr);
      gap: 28px;
    }
  }

  @media screen and (min-width: 990px) {
    .ai-product-gallery__grid-{{ ai_gen_id }} {
      grid-template-columns: repeat({{ block.settings.products_per_row }}, 1fr);
      gap: 32px;
    }
  }

  .ai-product-card-{{ ai_gen_id }} {
    background-color: {{ block.settings.card_background }};
    border-radius: {{ block.settings.card_border_radius }}px;
    overflow: hidden;
    box-shadow: 0 {{ block.settings.shadow_vertical_offset }}px {{ block.settings.shadow_blur }}px rgba(0, 0, 0, {{ block.settings.shadow_opacity | divided_by: 100.0 }});
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .ai-product-card-{{ ai_gen_id }}:hover {
    transform: translateY(-4px);
    box-shadow: 0 {{ block.settings.shadow_vertical_offset | plus: 8 }}px {{ block.settings.shadow_blur | plus: 10 }}px rgba(0, 0, 0, {{ block.settings.shadow_opacity | divided_by: 100.0 | times: 1.5 }});
  }

  .ai-product-card__image-wrapper-{{ ai_gen_id }} {
    position: relative;
    overflow: hidden;
    aspect-ratio: 1 / 1;
    background-color: #f4f4f4;
  }

  .ai-product-card__image-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .ai-product-card-{{ ai_gen_id }}:hover .ai-product-card__image-{{ ai_gen_id }} {
    transform: scale(1.08);
  }

  .ai-product-card__badge-{{ ai_gen_id }} {
    position: absolute;
    top: 12px;
    right: 12px;
    background-color: {{ block.settings.badge_background }};
    color: {{ block.settings.badge_text_color }};
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
  }

  .ai-product-card__content-{{ ai_gen_id }} {
    padding: 20px;
    display: flex;
    flex-direction: column;
    flex-grow: 1;
  }

  .ai-product-card__title-{{ ai_gen_id }} {
    font-size: 18px;
    font-weight: 600;
    color: {{ block.settings.text_color }};
    margin: 0 0 8px 0;
    line-height: 1.3;
  }

  .ai-product-card__title-link-{{ ai_gen_id }} {
    color: inherit;
    text-decoration: none;
  }

  .ai-product-card__title-link-{{ ai_gen_id }}:hover {
    opacity: 0.8;
  }

  .ai-product-card__price-{{ ai_gen_id }} {
    font-size: 20px;
    font-weight: 700;
    color: {{ block.settings.text_color }};
    margin: 0 0 16px 0;
  }

  .ai-product-card__price--compare-{{ ai_gen_id }} {
    text-decoration: line-through;
    opacity: 0.5;
    font-size: 16px;
    margin-right: 8px;
  }

  .ai-product-card__button-{{ ai_gen_id }} {
    margin-top: auto;
    width: 100%;
    padding: 14px 24px;
    background-color: {{ block.settings.button_background }};
    color: {{ block.settings.button_text_color }};
    border: none;
    border-radius: {{ block.settings.button_border_radius }}px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    text-align: center;
  }

  .ai-product-card__button-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.button_hover_background }};
    transform: translateY(-2px);
  }

  .ai-product-gallery__empty-{{ ai_gen_id }} {
    text-align: center;
    padding: 60px 20px;
    color: {{ block.settings.text_color }};
    opacity: 0.6;
  }
{% endstyle %}

<div class="ai-product-gallery-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-product-gallery__container-{{ ai_gen_id }}">
    {% if block.settings.heading != blank %}
      <div class="ai-product-gallery__header-{{ ai_gen_id }}">
        <h2 class="ai-product-gallery__heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
        {% if block.settings.subtitle != blank %}
          <p class="ai-product-gallery__subtitle-{{ ai_gen_id }}">{{ block.settings.subtitle }}</p>
        {% endif %}
      </div>
    {% endif %}

    {% liquid
      assign products_to_show = blank
      
      if block.settings.collection != blank
        assign products_to_show = block.settings.collection.products
      elsif block.settings.product_tag != blank
        assign products_to_show = collections.all.products | where: 'tags', block.settings.product_tag
      else
        assign products_to_show = collections.all.products
      endif
    %}

    {% if products_to_show.size > 0 %}
      <div class="ai-product-gallery__grid-{{ ai_gen_id }}">
        {% for product in products_to_show limit: block.settings.products_count %}
          <div class="ai-product-card-{{ ai_gen_id }}">
            <div class="ai-product-card__image-wrapper-{{ ai_gen_id }}">
              {% if product.featured_image %}
                <img
                  src="{{ product.featured_image | image_url: width: 800 }}"
                  alt="{{ product.featured_image.alt | escape }}"
                  loading="lazy"
                  width="800"
                  height="800"
                  class="ai-product-card__image-{{ ai_gen_id }}"
                >
              {% else %}
                <div class="ai-product-card__image-placeholder-{{ ai_gen_id }}">
                  {{ 'product-1' | placeholder_svg_tag }}
                </div>
              {% endif %}

              {% if product.compare_at_price > product.price %}
                <div class="ai-product-card__badge-{{ ai_gen_id }}">
                  {% if block.settings.discount_type == 'percentage' %}
                    -{{ product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price }}%
                  {% else %}
                    Save {{ product.compare_at_price | minus: product.price | money }}
                  {% endif %}
                </div>
              {% endif %}
            </div>

            <div class="ai-product-card__content-{{ ai_gen_id }}">
              <h3 class="ai-product-card__title-{{ ai_gen_id }}">
                <a href="{{ product.url }}" class="ai-product-card__title-link-{{ ai_gen_id }}">
                  {{ product.title }}
                </a>
              </h3>

              <div class="ai-product-card__price-{{ ai_gen_id }}">
                {% if product.compare_at_price > product.price %}
                  <span class="ai-product-card__price--compare-{{ ai_gen_id }}">
                    {{ product.compare_at_price | money }}
                  </span>
                {% endif %}
                <span>{{ product.price | money }}</span>
              </div>

              <a href="{{ product.url }}" class="ai-product-card__button-{{ ai_gen_id }}">
                {{ block.settings.button_text }}
              </a>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="ai-product-gallery__empty-{{ ai_gen_id }}">
        <p>No products found. Please select a collection or add products with the specified tag.</p>
      </div>
    {% endif %}
  </div>
</div>

{% schema %}
{
  "name": "Top products gallery",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "label": "Heading",
      "default": "Our Top Products"
    },
    {
      "type": "inline_richtext",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Customer favorites, made in Finland."
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection",
      "info": "Leave empty to use product tag instead"
    },
    {
      "type": "text",
      "id": "product_tag",
      "label": "Product tag",
      "default": "top",
      "info": "Only used if no collection is selected"
    },
    {
      "type": "range",
      "id": "products_count",
      "min": 2,
      "max": 12,
      "step": 1,
      "label": "Number of products",
      "default": 8
    },
    {
      "type": "range",
      "id": "products_per_row",
      "min": 2,
      "max": 4,
      "step": 1,
      "label": "Products per row (desktop)",
      "default": 4
    },
    {
      "type": "inline_richtext",
      "id": "button_text",
      "label": "Button text",
      "default": "Shop now"
    },
    {
      "type": "select",
      "id": "discount_type",
      "label": "Discount display",
      "options": [
        {
          "value": "percentage",
          "label": "Percentage"
        },
        {
          "value": "amount",
          "label": "Amount saved"
        }
      ],
      "default": "percentage"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 24,
      "max": 64,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 42
    },
    {
      "type": "range",
      "id": "subtitle_size",
      "min": 14,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Subtitle size",
      "default": 18
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#f0f0f0"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#1a2533"
    },
    {
      "type": "header",
      "content": "Product card"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card background",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "min": 0,
      "max": 40,
      "step": 4,
      "unit": "px",
      "label": "Card corner radius",
      "default": 24
    },
    {
      "type": "range",
      "id": "shadow_opacity",
      "min": 0,
      "max": 30,
      "step": 1,
      "unit": "%",
      "label": "Shadow opacity",
      "default": 10
    },
    {
      "type": "range",
      "id": "shadow_vertical_offset",
      "min": 0,
      "max": 32,
      "step": 2,
      "unit": "px",
      "label": "Shadow vertical offset",
      "default": 18
    },
    {
      "type": "range",
      "id": "shadow_blur",
      "min": 0,
      "max": 60,
      "step": 5,
      "unit": "px",
      "label": "Shadow blur",
      "default": 50
    },
    {
      "type": "header",
      "content": "Badge"
    },
    {
      "type": "color",
      "id": "badge_background",
      "label": "Badge background",
      "default": "#803cee"
    },
    {
      "type": "color",
      "id": "badge_text_color",
      "label": "Badge text",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Button"
    },
    {
      "type": "color",
      "id": "button_background",
      "label": "Button background",
      "default": "#0962fa"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_hover_background",
      "label": "Button hover background",
      "default": "#1a2533"
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "min": 0,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Button corner radius",
      "default": 60
    }
  ],
  "presets": [
    {
      "name": "Top products gallery"
    }
  ]
}
{% endschema %}
